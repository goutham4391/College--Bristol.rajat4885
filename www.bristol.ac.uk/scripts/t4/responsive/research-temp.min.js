/* author: ben.calder@bristol.ac.uk */
/* For use solely on Research site pending the official Pure profile widget */
!function(){"use strict";for(var a=document.querySelectorAll(".module.researchProfile"),b=0,c=a.length;c>b;b++)!function(){var c=a[b],e=c.querySelector("p a"),f=e&&e.getAttribute("href");atomic.get(f).success(function(a,b){d(a,b,c,e,f)}).error(function(){console.log("profile data not available")})}();var d=function(a,b,c,d,e){var f=document.createElement("div"),g=a.indexOf("<body id="),h=a.lastIndexOf("</body>"),i=a&&g&&h&&a.slice(g,h);if(i){f.innerHTML=i;var j,k=f.querySelector("#uobcms-content .person.overview"),l=k.querySelector("#vcard"),m=f.querySelector("#introtext"),n=k.querySelector("#showpagetitle").innerHTML,o=m.querySelector(".title").innerHTML.trim(),p=(l.querySelector(".email").innerHTML,m.querySelector(".fn .suffix"),l.querySelector("img.photo")),q=p.getAttribute("src"),r=(d.innerHTML,d.parentNode),s=k.querySelector("ul.publications"),t=s&&s.parentNode,u=t&&brisac.u.node_after(t),v=u&&u.getElementsByTagName("a")[0],w=v&&v.getAttribute("href"),x=v&&v.innerHTML.trim();w&&w.indexOf("/searchall.html?searchall=")<0&&"View complete publications list"===x&&(e=w),n&&(j='<h2 class="module-heading"><span class="mh-text">Researcher profile</span></h2><ul class="list-no-style listing listing-with-thumbs listing-with-divides"><li><a href="'+e+'">',q&&(j+='<img alt="" class="list-thumb img-circle" src="'+q+'">'),j+='<span class="list-item-title"><strong>'+n+"</strong></span></a>",o&&(j+='<span class="list-item-abstract">'+o+"</span>"),j+="</li></ul>",r.insertAdjacentHTML("beforebegin",j),r.parentNode.removeChild(r),brisac.u.removeClass("researchProfile",c))}}}();
